<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Qr API with Blazor Server - Bundle .NET</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="Introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="Beginner.html"><strong aria-hidden="true">2.</strong> Beginner</a></li><li class="chapter-item expanded "><a href="QrLibrary.html"><strong aria-hidden="true">3.</strong> Qr Library</a></li><li class="chapter-item expanded "><a href="QrDesktop.html"><strong aria-hidden="true">4.</strong> Qr .NET MAUI</a></li><li class="chapter-item expanded "><a href="QrApi.html" class="active"><strong aria-hidden="true">5.</strong> Qr API with Blazor Server</a></li><li class="chapter-item expanded "><a href="Thanks.html"><strong aria-hidden="true">6.</strong> Thanks</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Bundle .NET</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="using-this-library-in-a-net-blazor-server"><a class="header" href="#using-this-library-in-a-net-blazor-server">Using this library in a .NET Blazor server</a></h1>
<p>Now, wouldn't it be nice if we could generate these QRs by simply making a request to an API ? If you look in this repository you'll find a file in the postman folder containing a collection of postman requests. Your job is to deploy a .NET Blazor server hosting an API that can respond to these requests by generating a QR Code using your own library (QrLib).</p>
<h2 id="create-a-net-blazor-server-project"><a class="header" href="#create-a-net-blazor-server-project">Create a .NET Blazor Server project</a></h2>
<p>Let's start by adding a .NET Blazor server project to our solution and referencing QrLib.
It is the same process as the .NET MAUI App we created before, just right click on the solution in the solution explorer and add a Blazor Server project
Name it: <strong>QrGeneratorAPI</strong>
.NET Blazor can be used to render user interface as well as routing (and many other things) but we'll focus on routing and handling API requests.</p>
<h2 id="adding-a-dependency-to-a-local-net-library"><a class="header" href="#adding-a-dependency-to-a-local-net-library">Adding a dependency to a local .NET Library</a></h2>
<p>Now we want to use QrLib in that project,
since QrLib is in the same &quot;Solution&quot; (Bundle of projects), we don't need NuGet.
Instead, deploy <strong>QrGeneratorAPI</strong> in the solution explorer panel and right click the <strong>Dependencies</strong> tab, from there click <strong>Add project reference</strong> and select <strong>QrLib</strong>, finish by pressing Ok.</p>
<p>You are now able to use any public function exported by QrLib inside your project, you don't have to worry about any platform, everything is taken care of by the .NET Framework.</p>
<h2 id="adding-qrgenerator-as-a-singleton-service"><a class="header" href="#adding-qrgenerator-as-a-singleton-service">Adding QrGenerator as a singleton service</a></h2>
<p>Blazor Server provides a dependency injection logic, meaning you can register services / resources instances and access them from different parts of the code, whether it is in a controller or in a page.</p>
<p>Let's register our generator as a service, to do so, head over to <strong>Program.cs</strong>
You'll notice a variable called builder, add a new line before</p>
<pre><code class="language-C#">builder.Services.AddRazorPages();
</code></pre>
<p>and type in this code</p>
<pre><code class="language-C#">builder.Services.AddSingleton&lt;IQrGenerator&gt;(new QrGenerator());
</code></pre>
<p>you might have to add a using statement as such:</p>
<pre><code class="language-C#">using QrLib;
</code></pre>
<p>If you get an error saying QrLib does not exist, you didn't add a dependency to QrLib, refer to the previous section.
This lines tells Blazor to create an instance of QrGenerator that implements the interface IQrGenerator as a singleton and make it available for anyone asking.
<em>Singleton</em> is the service lifetime, here are all of the available lifetimes:</p>
<ul>
<li>Transient operations are always different, a new instance is created with every retrieval of the service.</li>
<li>Scoped operations change only with a new scope, but are the same instance within a scope.</li>
<li>Singleton operations are always the same, a new instance is only created once.</li>
</ul>
<h2 id="adding-a-controller"><a class="header" href="#adding-a-controller">Adding a controller</a></h2>
<p>Create a <strong>Controllers</strong> folder in the solution, right click on it, and add a <strong>Controller</strong> file, choose <strong>API &gt; Empty API Controller</strong> and name it <em>QrController.cs</em>
The created file should have this structure:</p>
<pre><code class="language-C#">using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;

namespace QrGeneratorAPI.Controllers
{
    [Route(&quot;api/[controller]&quot;)]
    [ApiController]
    public class QrController : ControllerBase
    {
    }
}
</code></pre>
<p>Remove the Route attribute as we won't need a global one</p>
<h2 id="injecting-a-service-into-a-controller"><a class="header" href="#injecting-a-service-into-a-controller">Injecting a service into a controller</a></h2>
<p>Let's get our QrGenerator injected into our controller, to do so, start by adding a <strong>IQrGenerator</strong> variable to your class as private and add a constructor to your class like so:</p>
<pre><code class="language-C#">using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;

namespace QrGeneratorAPI.Controllers
{
    private IQrGenerator QrGenerator { get; set; }

    public QrController(IQrGenerator qrGenerator)
    {
        if (qrGenerator == null)
            throw new ArgumentNullException(nameof(qrGenerator));
        this.QrGenerator = qrGenerator;
    }
}
</code></pre>
<p>Blazor DI will take care of injecting the service as a parameter to your constructor when constructing the instance, you don't have anything particular to do.</p>
<h2 id="adding-routes-handler-to-your-controller"><a class="header" href="#adding-routes-handler-to-your-controller">Adding routes handler to your controller</a></h2>
<p>Now, let's get some routes in our controller shall we;
we're going to need three routes:</p>
<ul>
<li>A route to generate a Qr Code from text</li>
<li>A route to generate a Qr Code from a phone number</li>
<li>A route to generate a Qr Code from an email structure</li>
</ul>
<p>If you did not implement all of these functions in your library, you can go back and do it, if you don't want to, just don't implement the routes for them.
Adding a route handler is really easy, all you have to do is create a function, add the parameters you want aswell as how to get them (Exemple: From the body, from json, from the query URL...), add the HTTP method to handle, and a return type!
I'll make the first one for you, so you can reuse the code for your own routes</p>
<pre><code class="language-C#">[HttpGet] // We handle HTTP Get requests ...
[Route(&quot;api/qr/text&quot;)] // ... on https://domain.com/api/qr/text
public IActionResult GetText([FromQuery(Name = &quot;text&quot;)] string text) // We need a parameter named text that will be taken from the query URL ?name=
{
    return Ok(&quot;Everything went fine&quot;); // We return a 200 with a message
}
</code></pre>
<p>Now that you have your routes setup, let's make them do useful things, but I'm not going to help you for this one, I'll just guide you a bit.</p>
<p>Your code will need to do these things:</p>
<ul>
<li>Call QrGenerator.From<em>Method</em> and get the byte data</li>
<li>return a file using File() with <em>image/png</em> as the MIME type.</li>
</ul>
<h3 id="tasks"><a class="header" href="#tasks">Tasks:</a></h3>
<ul>
<li><input disabled="" type="checkbox"/>
Add a route handler for Qr Text generation</li>
<li><input disabled="" type="checkbox"/>
Add a route handler for Qr Phone generation</li>
<li><input disabled="" type="checkbox"/>
Add a route handler for Qr Mail generation</li>
</ul>
<h2 id="expose-these-routes"><a class="header" href="#expose-these-routes">Expose these routes</a></h2>
<p>You're almost done, we have to tell Blazor to expose our controller along with the routes, head back over to <strong>Program.cs</strong>,
from there, add this code:</p>
<pre><code class="language-C#">app.MapFallbackToPage(&quot;/_Host&quot;);

// Add this here
app.UseEndpoints((endpoints) =&gt;
{
    endpoints.MapControllers();
});
//

app.Run();
</code></pre>
<p>This simply tells Blazor how to behave with our controller and how to expose it.</p>
<h2 id="test-with-postman"><a class="header" href="#test-with-postman">Test with Postman</a></h2>
<p>You're all set! Go ahead and open the collection in Postman and try some requests, you will probably have to change the URLs to match your controller routes.</p>
<p>If you succedeed, you should see your QR codes directly in postman like so:
<img src="./img/postman.png" alt="A successful postman request" /></p>
<h2 id="deploying-on-azure"><a class="header" href="#deploying-on-azure">Deploying on Azure</a></h2>
<p>Congratulations ! Let's now see how easy it is to deploy it on azure
This won't cost you any money as you technically have a student azure account, check out the advantages of being a student (https://azure.microsoft.com/en-us/free/students/).</p>
<p>If you went this far, you can go ahead and deploy this on azure, all you have to do is right click on your .NET Blazor server project in the solution explorer &gt; Click <strong>Publish</strong>, you'll have multiple options here, deploying on a docker container, to an FTP server etc., chose Azure and follow the instructions !</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="QrDesktop.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="Thanks.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="QrDesktop.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="Thanks.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
